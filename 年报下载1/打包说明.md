# 批量执行脚本打包说明

## 一、打包步骤

### 方法1：使用打包脚本（推荐）

1. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

2. 运行打包脚本：
   ```bash
   python build_exe.py
   ```

3. 打包完成后，exe文件在 `dist` 文件夹中

### 方法2：手动打包

1. 安装PyInstaller：
   ```bash
   pip install pyinstaller
   ```

2. 执行打包命令：
   ```bash
   pyinstaller --onefile --windowed --name=批量执行 --clean --noconfirm --hidden-import=pandas --hidden-import=openpyxl --hidden-import=xlrd --hidden-import=xlsxwriter 批量执行.py
   ```

## 二、打包后的文件结构

打包完成后，需要将以下文件一起分发：

```
年报下载1/
├── 批量执行.exe          # 打包后的可执行文件
├── 是否下载.xlsx          # Excel状态文件
├── 国家图书馆.py          # 所有图书馆脚本
├── 上海图书馆.py
├── ... (其他图书馆脚本)
├── config.txt            # 配置文件
└── logs/                 # 日志文件夹（运行后自动创建）
    └── 批量执行_20240101_120000.log
```

## 三、使用说明

1. **首次使用**：
   - 将所有文件复制到目标电脑
   - 确保有 `是否下载.xlsx` 文件
   - 确保有 `config.txt` 配置文件
   - 双击运行 `批量执行.exe`

2. **日志查看**：
   - 运行后会在同目录下自动创建 `logs` 文件夹
   - 每次运行会生成一个带时间戳的日志文件
   - 日志文件包含所有执行过程和结果

3. **无控制台模式**：
   - exe文件默认不显示控制台窗口
   - 所有输出都保存在日志文件中
   - 可以通过查看日志文件了解执行情况

## 四、注意事项

1. **依赖问题**：
   - 打包后的exe文件包含了所有依赖，不需要安装Python环境
   - 但需要确保所有图书馆脚本文件都在同一目录

2. **文件大小**：
   - 打包后的exe文件可能较大（几十MB到上百MB）
   - 这是因为包含了Python解释器和所有依赖库

3. **杀毒软件**：
   - 某些杀毒软件可能会误报，需要添加信任

4. **首次运行**：
   - 首次运行可能需要几秒钟启动时间
   - 如果被杀毒软件拦截，请添加信任

## 五、故障排除

1. **exe无法运行**：
   - 检查是否有杀毒软件拦截
   - 检查是否缺少必要的文件（是否下载.xlsx等）

2. **找不到脚本**：
   - 确保所有.py脚本文件都在exe同一目录

3. **日志文件位置**：
   - 日志文件保存在exe同目录下的 `logs` 文件夹中

4. **需要显示控制台**：
   - 如果打包时使用了 `--windowed`，可以改为 `--console` 来显示控制台
   - 或者重新打包时不使用 `--windowed` 参数


# 批量执行图书馆年报下载脚本

## 功能说明

本脚本可以批量执行所有图书馆的年报下载脚本，自动检查Excel中的下载状态，只执行未下载的脚本，并在下载成功后自动更新Excel状态。

## 主要特性

- ✅ 自动读取Excel文件，检查下载状态
- ✅ 只执行未下载的脚本，跳过已下载的
- ✅ 下载成功后自动更新Excel状态
- ✅ 完整的日志记录功能
- ✅ 支持无控制台模式（打包成exe后）
- ✅ 日志文件自动保存到logs文件夹

## 使用方法

### 方式1：直接运行Python脚本

```bash
python 批量执行.py
```

### 方式2：打包成exe文件（推荐）

1. **一键打包**：
   - 双击运行 `打包.bat`（Windows）
   - 或运行 `python build_exe.py`

2. **打包完成后**：
   - exe文件在 `dist` 文件夹中
   - 将exe文件与所有图书馆脚本放在同一目录
   - 双击运行exe文件

3. **查看日志**：
   - 运行后会在同目录下创建 `logs` 文件夹
   - 每次运行生成一个带时间戳的日志文件

## 文件结构

```
年报下载1/
├── 批量执行.py          # 主脚本
├── 批量执行.exe          # 打包后的exe（打包后生成）
├── 是否下载.xlsx         # Excel状态文件（必需）
├── config.txt           # 配置文件（必需）
├── 国家图书馆.py         # 图书馆脚本
├── 上海图书馆.py
├── ... (其他图书馆脚本)
├── logs/                # 日志文件夹（运行后自动创建）
│   └── 批量执行_20240101_120000.log
├── build_exe.py         # 打包脚本
├── 打包.bat             # 一键打包批处理文件
├── requirements.txt     # Python依赖列表
└── 打包说明.md          # 详细打包说明
```

## 配置要求

1. **Excel文件**：
   - 文件名必须是 `是否下载.xlsx`
   - 必须包含图书馆名称列和"是否下载"列
   - 如果"是否下载"列为"是"，则跳过该图书馆

2. **config.txt**：
   - 必须包含 `output_folder` 配置项
   - 指定年报下载保存的文件夹路径

## 日志说明

- 日志文件保存在 `logs` 文件夹中
- 文件名格式：`批量执行_YYYYMMDD_HHMMSS.log`
- 日志包含：
  - 执行时间
  - 每个脚本的执行状态
  - 成功/失败信息
  - 错误详情

## 注意事项

1. **首次运行**：
   - 确保所有图书馆脚本文件都在同一目录
   - 确保有 `是否下载.xlsx` 文件
   - 确保有 `config.txt` 配置文件

2. **打包后的exe**：
   - 不需要Python环境即可运行
   - 默认不显示控制台窗口
   - 所有输出都在日志文件中

3. **网络连接**：
   - 确保网络连接正常
   - 某些网站可能需要VPN或特殊网络环境

## 故障排除

1. **Excel文件读取失败**：
   - 检查文件是否存在
   - 检查文件是否被其他程序打开
   - 检查文件格式是否正确

2. **脚本执行失败**：
   - 查看日志文件了解详细错误信息
   - 检查网络连接
   - 检查配置文件是否正确

3. **打包失败**：
   - 确保已安装所有依赖：`pip install -r requirements.txt`
   - 确保已安装PyInstaller：`pip install pyinstaller`

## 更新日志

- v1.0: 初始版本，支持批量执行和日志记录
- v1.1: 添加无控制台模式支持，优化编码处理

